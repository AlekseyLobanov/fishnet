#!/bin/sh

if [ -f /proc/cpuinfo ]; then
  ARCH=x86-64
  # detect if the CPU supports "modern" features
  if grep -q "^flags.*popcnt" /proc/cpuinfo ; then
      ARCH=x86-64-modern
  fi
else
  ARCH=x86-64-modern
fi

echo "- Detected architecture $ARCH"

echo "- Fetching latest Stockfish..."
git submodule update --init

cd Stockfish/src
echo "- Building Stockfish..."
make build ARCH=$ARCH > /dev/null
cd ../..
echo "- Done!"
